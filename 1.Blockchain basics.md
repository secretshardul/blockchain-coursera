# Blockchain basics
Blockchain is a time-stamped record of immutable transactions. It is managed by a cluster of computers and not owned by any single entity.

## Properties
1. **Decentralization**: Completely P2P
2. **Transparency**: All records are publically visible. However transactions are represented by hash address and not names of entities.
3. **Immutability**: Blocks are linked to one another through **hash pointers**. Block 3 contains hash value of block 3, block 2 contains hash value of block 1 and so on. Any tampering will hence change the values of the entire block(avalance effect in hashes).

## Structure
- **Transactions and blocks**: The basic unit is a transaction. Many transactions form a block. Blocks together form the blockchain.
- **Miners** carry out validation and consensus process on new blocks. The new block is then added to the chain.
- **Unspend Transaction Output(UTXO)**: Amount of leftover bitcoin you recieve after every transaction. In real world a person may have a $1 note and a $2 note in cash. Together they form his $3 balance. Similarly the sum of a person's UTXOs form his balance. He has the option to combine these into one UTXO. UTXOs give the state of the blockchain.
Ethereum on other hand stores total balance of each account.

UTXOs contain
    1. UID of transaction which created this UTXO
    2. Index of this UTXO in the list of UTXOs generated by the transaction.
    3. Amount
    4. Optional: conditions under which output can be spent.

## Blockchain transactions
Blockchain peers are responsible for
    1. Validation of transactions
    2. Gather transactions in a block
    2. Broadcasting valid transactions and blocks: They use gossip protocol because bitcoin network is completely decentralized.
    3. Consensus on next block creation.
    4. Chaining blocks to form an immutable record.

Blockchain has 2 types of participants
1. Those initiating transfer
2. **Miners**: Validate transactions, compete and reach consensus on the right to create blocks and finally broadcast the block to confirm transaction.
    - **Proof of work**: Miners compete for the right to create blocks. Those who solve a computationally intensive puzzle in shortest period of time and give a proof of work are awarded this right by the network. This keeps the chain uniform and prevents it from branching out.
    - **Coinbase transaction/transaction zero**: First transaction of a confirmed block which rewards bitcoins to the miner. It has a **special UTXO** which has no UTXO. On other hand members performing transaction must pay a fee.

## Blockchain classification
### 1. Based on usage
1. Cryptocurrency only: Eg. Bitcoin.
2. Cryptocurrency + Business Logic: Eg. Ethereum. It extended Bitcoin's ability to execute scripts into smart contracts.
3. Business logic only: Eg. Hyperledger.

### 2. Based on access
1. **Public**: Anyone can read or write. Eg. Bitcoin
2. **Private**: Hyperledger
3. **Permissioned**: Anyone can read but only those with permission can write. Eg. use case is governance.

# Ethereum basics
1. Allows code execution through smart contracts which run on ethereum virtual machine.
2. Transactions have a gas cost.
3. Uses an **account based model** instead of UTXOs. Each account has an associated ether balance.
4. Ethereum has 2 types of accounts:
    1. **Externally owned accounts**: Needed to make transactions in ethereum. They're associated with a private key.
    2. **Contract accounts**: Controlled by smart contract code and an externally owned account.
5. Ethereum transactions update state of the blockchain. The blockchain stores state and transaction reciepts.
6. **Ethash PoW algorithm**: Uses a memory based instead of CPU based approach for mining. Bitcoin faced an issue of mining centralization due to emergence of specialized hardware. Memory hardness improving hardware can't be easily designed.
7. **Incentive model**:
    1. Transactions: Have a gas cost
    2. Blocks: have 2 parameters
        - **Gas limit**: Max gas available with the block.
        - **Gas spent**: Actual gas spent.
Gas allows currency independent evaluation of transaction fees. Ethereum value can change but gas cost does not.
8. Miners:
    - **Winner**: Gets ether for solving puzzle first.
    - **Ommer**: They are nodes which solved puzzle later. The ommer blocks generated by them are not discarded. They're added as side blocks to the main chain for network. Ommers get a small amount of coins as well.

# Algorithms behind blockchain
1. **Elliptic curve cryptography(ECC)**: Used for encoding. It's a type of **assymetric key cryptography**, stronger than RSA.
2. **Hashing**: Used to uniquely identify transactions and blocks. SHA256 and Kecchak 256 algorithm is used.
    1. **Simple hash**: To find hash of fixed length items like items in block header or composite block integrity.
    2. **Merkle tree**: Used when size of items is not known, eg. state changes in block.

## Working
1. Key and address generation
    1. Generate 256 random value(private key)
    2. Apply ECC to get public key.
    3. Apply hash function on public key to get account address.
2. Ensuring transaction integrity through digital signature
    1. Calulate hash value/signature of payload. Encrypt it with private key and send it.
    2. Reciever decodes signature using public key. He then computes hash value of payload himself and compares it with the signature.

## Puzzle calculation
1. Miner generates a random nonce.
2. Hash function is applied on block hash and the nonce. If the result is less than block difficulty then puzzle is solved. This miner gets the reward.
```
BHash is block header hash, F is block difficulty

H=hash(BHash, nonce)
if H > F
    puzzle is solved
```

